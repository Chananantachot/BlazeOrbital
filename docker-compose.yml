version: '3.8'
services:
  centralserver:
    build:
      context: ./CentralServer
      dockerfile: Dockerfile
    ports:
      - "7087:443"
    extra_hosts:
      - "centralserver.local:192.168.56.10"
      - "manufacturinghub.local:192.168.56.11"   
    networks:
      - blazeorbital   

  manufacturinghub:
    build:
      context: ./ManufacturingHub
      dockerfile: Dockerfile
    ports:
      - "7070:443"
    depends_on:
      - nginx
      #- centralserver
    extra_hosts:
      - "centralserver.local:192.168.56.10"
      - "manufacturinghub.local:192.168.56.11"  
    volumes:
      - blazor_wwwroot:/usr/share/nginx/html  # Ensures the files are accessible in the right location
    networks:
      - blazeorbital
      
  nginx:
    image: nginx:1.13.12-alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./ManufacturingHub/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/ssl/nginx.crt:/etc/nginx/ssl/nginx.crt
      - ./nginx/ssl/nginx.key:/etc/nginx/ssl/nginx.key
      - blazor_wwwroot:/usr/share/nginx/html     
    extra_hosts:
      - "centralserver.local:192.168.56.10"
      - "manufacturinghub.local:192.168.56.11"
    networks:
      - blazeorbital  
      
volumes:
  blazor_wwwroot:  # This ensures Docker recognizes it properly

networks:
  blazeorbital:
    driver: bridge
